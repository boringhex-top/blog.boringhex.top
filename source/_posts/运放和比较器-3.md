---
title: 运放和比较器-3
date: 2023-05-17 12:16:34
categories:
tags:
    - 硬件
---

## 比较器内部认识

通过前面的分析我们已经对比较器和运放的内部结构有了一定了解，接下来我们找一个比较器通过手册来对比巩固下我们前面的知识，

下面是TI公司的LM339DR内部图，这是一个四合一的比较器，我们看下图。

![LM339DR内部图](https://imgs.boringhex.top/blog/202305091702586.png)

这个图与我们上一章学习的很相似，基本是一样的，不同之处我们可以继续研究一下。

<!-- more -->

在图中多了几个二极管，这几个二极管有什么作用吗？

首先，我们先想一下，在没有这几个二极管的情况下，恒流源总电流是80uA，那在IN+和IN-相等的情况下，Q1和Q3的Ic电流都为40uA，放大倍数继续按100计算（忽略基极电流，实际是将40uA分成101份），Q1的基极电流为0.4uA，等到达Q2时又要分为两路，对于Q2，它的基极电流将会是0.004uA。对于Q2这个三极管，它的基极是有点小的。我们希望，Q2越快进入放大状态越好，这样对于第二级来说比较器的斜率才会更大。

> 三极管进入放大区时也会有一个阈值。

当加入D1,D2两个二极管时，会有10uA电流流经二极管。那Q2的Ib就变成了0.1uA，这就比之前的0.004uA大很多了，由于放大区也有一个阈值区间。所以，D1，D2就起到了加速让管子导通的作用。

我们继续看D3，D4。所有信号传递，经过器件多了都会有延迟。比如当IN-电压升高时，比较器IN-比IN+大的时候，比较器输出低，我们希望斜率更陡，更快变换电位，我们希望Q4能够迅速截止，就是Q4的E极电压跟随IN-电压升高而升高，这不是真的截止，只是想让电压跟随。

![响应时间](https://imgs.boringhex.top/blog/202305091704429.png)

这是数据手册中，此比较器最快响应时间。为达到更快的速度，D3,D4就起到了快速响应的作用。IN-变化时，Q4的E极也能快速变化，减小信号延迟。

> 小贴士：  三极管基极、发射极间的反应速度没有二极管的反应快，这里需要的是快速响应外部电位的变化的器件。

我们在初步认识放大器时只会谈论源外部电路回路和阻抗，并没有谈到过源的内部。从后面开始，我们需要把源内部的回路也要考虑进去，这样对理解运放很有帮助。

## 虚短、虚断的由来

比较器或运放本身是没有负反馈的，像三极管电流放大一样没有负反馈，只有外接负反馈后，输出才可能发生变化。我们学习运放和比较器的一种有效方法就是对比三极管学习。

![共射放大电路](https://imgs.boringhex.top/blog/202305050958079.png)

上图中当Ib为1mA时，三极管就会工作在饱和状态，三极管E极没有接电阻属于饱和接法。三极管放大的是Ib的电流，运放放大的是俩个信号的电压差，因此三极管和运放在放大对象上是有差别的。

放大倍数具体是多少，不同的制造商，不同批次是会有差别的，我们在分析时依旧认为三极管放大倍数为100倍，运放的放大倍数为10万倍，为的是计算方便，理解方便。当想确切知道某款具体型号的管子放大倍数是多少时需要查看对应的数据手册。

在实际中任何两个信号都会有点差别，放大10万倍后会远远超过电源电压（会被钳位到电源电压），输出会接近电源电压，那怎么样才能精确的控制放大倍数呢？

![恒流源](https://imgs.boringhex.top/blog/202305091708249.png)

我们用三极管的放大来对比学习，我们首先回想下三极管作为恒流源的电路。如上图，假设我们需要1mA的Ic，那么我们只要保证A点电压为2V就可以保证Ic= 1mA了。也就是D点电压比A点高0.7V时就能保证Ic电流稳定输出。那Ib电流要多少呢？是不是1mA的1/100，输入uA级别。再分析D点电压，它是外部（单片机或其他电源）提供的，假设就是3.3V单片机提供，那只要保证红色回路分压为2.7V即可，电流为mA级别时就可以忽略绿线的电流，结合功耗问题，红线回路有1-2mA就可以。这样就可以就算出分压电阻大小，来准确控制电流。这里主要想表达的是三级管的具体放大倍数有多大差异在应用中我们不太关注，这里不会影响我们的1毫安。当然了这里Ic=1mA确定后Ib一定也就是10uA了。

同样的道理来理解运放，只是把电流转换为电压考虑。

我们如果想让运放输出1V，那么两端的电压差应该是0.000001V。现在就等效于三极管，需要引入负反馈。 需要将输出引到输入。输入信号的差值是输入正端信号减去负端信号为0.000001V，输出才能是1V。输出高了，就应该把高出电压反馈到负输入端上，来减小输入的差值。所以输出电压信号需要通过某些器件接到输入端，这样就能形成反馈。

![运放](https://imgs.boringhex.top/blog/202305091709138.png)

我们看上图，假设运放5V供电，那输出电压是从0V逐步增加到一个很高的电压的，我们可以讨论下这个上升的过程，在开始时有没有负反馈它都会有一个斜率上升，比如A点电压上升到0.5V时，U2电压也时0.5V，Ui 假设为1V，是不是U1-U2还是正，A点电压会继续上升，当上升到0.999999V时，U1和U2的差值为0.000001V，输出就是1V。如果出现意外输出1.01V了，那U1-U2的差值是不是也会变小，来改变输出电压，这样输出就可以保持在稳定的状态。

那Rf和R2把输出电压分压，使分压后的电压接近U1。这样U1和U2相差0.000001V，是很相近的，基本相等，我们取个名字叫做虚短。

不管Rf和R2的取值是多少，U1和U2的差值相差10万分之一。换句话说就是U1确定后，U2的值基本也就十分接近这个值了。也就是**U1和U2永远相近但不相等**。

我们改变Rf和R2的值最终改变的U2的电压，不管我们怎么改变分压，U2的值都无限接近U1的值，我们把输出电压Uo与U2关系建立起来：

（Uo-U2）/Rf = U2/R12

我们的分析不是由虚短和虚断来得出结论的，而是是根据电路表现的特征，起了两个名字，一个叫虚短，一个叫虚断。所以不要再说 U1 和 U2 相等是因为虚短，而是因为 10 万倍的放大能力和负反馈，才有了 U1 约等于 U2，然后起个名字叫虚短。
