---
title: cmake?make?scons?ninja?
date: 2023-06-25 12:21:19
categories:
tags:
    - cmake
    - ci/cd
---

CMake、Make和SCons都是流行的C语言构建系统，它们用于自动化项目构建过程。这些构建系统的主要目标是简化编译和链接源代码以创建可执行文件的过程。Ninja则是后起之秀，最初设计用于构建Chrome浏览器这个大型代码库，以其简单快速著称。

<!-- more -->

1. CMake

   CMake是一个跨平台的自动构建工具，可以生成各种编译器和IDE的项目文件。CMake使用CMakeLists.txt文件来描述项目的构建过程。

   CMake是由Bill Hoffman和Ken Martin于2000年代初创建的。痛感到传统的Make系统无法很好地满足跨平台和大型项目的需求，他们试图创建一个更先进和灵活的构建系统。CMake是一种跨平台的元构建系统，可以生成Makefile、Visual Studio、Xcode等主流编译器的项目文件。由于CMake可以自动处理平台和编译器差异，因此迅速成为了大型和跨平台项目的首选。

   优点：
   - 跨平台支持：CMake可以在多种操作系统和编译器上工作。
   - 自动生成：CMake可以生成各种编译器和IDE的项目文件，如Makefiles、Visual Studio解决方案等。
   - 灵活性：CMake支持定制构建过程，可以根据不同平台和编译器进行调整。
   - 社区支持：CMake有一个庞大的用户社区，可以帮助解决问题。

   缺点：
   - 学习曲线：CMake的语法和概念与其他构建工具不同，需要时间学习。
   - 速度：CMake的配置过程可能较慢，特别是在大型项目中。

2. Make

   Make是一个经典的构建工具，最早在Unix系统上使用。Make使用Makefile文件来描述项目的构建过程。

   Make是最早的构建工具之一，它最早由斯图尔特·费尔德曼（Stuart Feldman）于1977年设计并发布，随后成为了Unix和Linux系统中广泛使用的编译器。在很长的时间里，Make被认为是编程世界中的默认构建工具。Make以其简单、高效和灵活的特点而受到广泛欢迎，但与现代构建工具相比，它可能缺少某些功能。

   优点：
   - 简单：构建目标比较单一时，Make的语法相对简单，易于学习和使用，比如在以前的文章 [STM32 裸机编程指南 - 4](https://mp.weixin.qq.com/s?__biz=MzA3NzMyNTIyOA==&mid=2651480180&idx=1&sn=bea5d80bffc304500ec9fa20458f6464&chksm=84ad76b7b3daffa1e7833bf2bc19261bd693086a42cc283ab0dadd4194f79b5f8ae3c9925140#rd) 中介绍了使用make实现stm32构建自动化，这个makefile文件可以作为模板用于stm32系列mcu程序构建。
   - 广泛支持：Make在各种操作系统和平台上都有支持。
   - 性能：Make构建过程通常比较快，尤其是在小型项目中。

   缺点：
   - 跨平台限制：Makefile可能需要针对不同的操作系统和编译器进行调整。
   - 不支持自动生成：相对于CMake，Make不能自动生成项目文件。
   - 缺乏某些高级功能：Make相对于其他构建系统，可能缺乏某些高级功能，如自动依赖管理等。

3. SCons

   SCons是一个用Python编写的构建工具，它使用SConstruct文件来描述项目的构建过程。

   SCons是受Make和CMake启发的构建工具，于2001年首次发布。SCons最大的特点是利用Python脚本作为构建文件的语法。Python脚本提供了一个简洁而强大的方法来描述项目的构建过程。此外，作为一种跨平台的构建工具，SCons还具有自动依赖管理功能。尽管如此，随着其他构建工具的发展，SCons的流行程度逐渐下降，尤其在国内。

   优点：
   - 跨平台支持：SCons可以在多种操作系统和编译器上工作。
   - 灵活性：SCons允许使用Python脚本来描述构建过程，这使得构建过程非常灵活和可扩展。
   - 自动依赖管理：SCons可以自动处理项目中的依赖关系，无需手动管理。
   - 社区支持：SCons也有一个活跃的用户社区。

   缺点：
   - 速度：SCons的构建速度相对较慢，特别是在大型项目中。
   - 学习曲线：SCons需要用户熟悉Python语言，这可能对一些没有Python经验的开发者来说是一个挑战。但是“人生苦短，我用python”，python作为一种超级流行语言，应用也超级广泛，掌握python几乎已是基本要求。

4. Ninja

   Ninja是一个小巧、快速且自称为“完全兼容”的构建系统。它的设计目标是专注于生成构建文件的速度，使得大型项目的构建过程变得轻松。与Make或CMake这样的工具相比，Ninja具有简单性和速度优势。

   Ninja是由Google的Evan Martin于2010年代初创建的。Ninja的设计目标是为了解决一些特定问题，特别是在构建大型代码库（如Chrome）时实现高速并发构建。Ninja的核心设计是简单而快速，这使得它能够轻松集成到其他构建系统（如CMake）中。

   Ninja的主要特点：

   1. 简单：Ninja的主要目标是简单，只侧重于如何高效地构建项目。Ninja的规则非常简单，可以轻松配置构建脚本。

   2. 速度：Ninja主要关注构建速度，无论是在大型项目还是在小型项目中。Ninja的构建速度通常比其竞争者快，尤其是在具有高度并发构建的场景中。

   3. 易于集成：Ninja非常适合与其他构建系统集成。例如，CMake可以生成Ninja构建文件，开发人员可以选择使用CMake配置项目并使用Ninja负责实际构建过程。

   4. 跨平台：与任何操作系统或平台兼容。Ninja可以在多种操作系统和编译器上运行。

   Ninja的缺点：

   5. 不直接支持高级功能：与CMake或SCons这样功能更丰富的构建系统相比，Ninja本身不直接提供高级功能，如自动依赖管理或自动生成项目文件。

   6. 学习资源：虽然Ninja被描述为易学且易用，但与CMake、Make和SCons相比，可能找不到足够的学习资源和教程。

   Ninja是一种专注于简单性和速度的构建工具。虽然它可能缺乏一些高级功能，但它可以与其他构建工具（如CMake）集成，以实现更完整的构建解决方案。对于重视速度和简单性的项目，Ninja是一个值得考虑的选择。

接下来再集中总结下这几种工具：

1. 跨平台支持：
CMake、SCons和Ninja天然具有跨平台支持，可以在不同操作系统和编译器上运行。而Make，虽然被广泛支持，但Makefile可能需要针对不同操作系统进行调整。

1. 生成构建文件：
CMake可以生成各种编译器和IDE的项目文件，如Makefiles、Visual Studio解决方案等。而SCons和Ninja只支持生成自身的构建文件。Make不支持自动生成项目文件。

1. 语法和学习曲线：
CMake拥有自定义的语法，因此需要学习一套新的规则，可能导致较陡的学习曲线。Make语法相对简单，但在某些情况下可能变得复杂。SCons使用Python脚本描述构建过程，对于已熟悉Python的开发者来说可能更容易上手。Ninja具有简单易学的语法，但可能找不到足够的学习资源和教程。

1. 构建速度：
Ninja以其构建速度而闻名，无论是大型项目还是小型项目。SCons的构建速度通常较慢，尤其是在大型项目中。Make在小型项目中的构建速度较快，但在大型项目中可能表现不佳。CMake的配置过程可能较慢，实际的构建速度取决于选用的后端（例如Make或Ninja）。

1. 灵活性和扩展性：
SCons和CMake具有很高的灵活性和扩展性，使用它们可以方便地配置和定制项目的构建过程。 Make的灵活性较低，而Ninja居于两者之间，因为它允许定制规则，但不提供高级功能。

1. 自动依赖管理：
SCons内置了自动依赖管理，可以处理项目中的依赖关系。虽然CMake和Make在某种程度上也可以处理依赖关系，但它们的功能可能没有SCons那么强大。Ninja则依赖于其他工具（如CMake）来处理依赖关系。

1. 社区支持：
CMake和Make有庞大的用户社区，因此在碰到问题时，可以找到大量的解决方案和资源。SCons和Ninja的社区规模相对较小，但它们也有一定的支持。

根据项目需求和个人喜好，开发者可以选择最适合他们的构建系统。CMake适合大型项目和跨平台开发，具有良好的自动化生成能力。Make适用于简单和小型项目，易于学习和使用；SCons具有灵活性和自动依赖管理的优点，对于需要高度定制和扩展的项目来说是一个好的选择；Ninja则以速度和简单性为主要特点，对于追求构建速度的项目来说是一个非常好的选择。

国内两大非常流行的嵌入式开源项目，RT-Thread RTOS使用了`SCons`，而ESP-IDF则选择了`CMake+Ninja`，从目前的体验上，我觉得乐鑫是国内半导体厂商中最重视软件开发生态、最用心维护开源社区的企业之一，文档资料的质量也是非常高，相信这样的厂商会越来越多，国内开源生态会越来越好。
