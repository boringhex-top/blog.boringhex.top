---
title: 运放和比较器-4
date: 2023-05-26 17:36:34
categories:
tags:
    - 硬件
---

> 说到运放，是离不开共模、差模、虚短、虚断这些概念的。大家可以想一下运放是怎么设计出来的。

我们想下前面提到的电流源，就是将电压信号转为电流源。然后电流源串一个大电阻，就得到一个电压。这中间的电流源起到中转的作用。运放内部就是利用三极管对电流源进行控制的。运放内部设计思想也是通过这种思路一步一步演变来的。

总结下运放设计思想的三部曲吧：

1. 电压转为电流。把输入信号电压差转为电流差，然后进行电流差放大。
2. 电流转为电压。放大电压。
3. 输出。功率放大，电流电压均放大。

<!-- more -->

电压转为电流，这一步需要进一步来研究。这个电压就是Vin，也就是输入电压，那这一步需要共模阻抗十分大。最好还有电流放大（输入阻抗十分大，输入电流就会非常小，输出高电压的话就需要极大的电阻，设计起来不容易实现）。

我们来讨论下运放第二级的作用。运放的作用主要就是放大电压，理想的运放是放大无穷倍。运放放大的是输出对地的幅值，那么，是不是需要把差分电流信号转化为单端对地的电流信号。由于第一级是两个电压源，因此会有两个电流源。所以我们要将电流差转为一个对地的电流源。然后，这个对地的电流源再经过电阻就会输出一个对地的电压了。只有电流大，电阻值大，电压输出才能很大。这样这一级的任务算是完成了。

继续仔细想一下，电压输出很高的原因是由于电流经过了大电阻。幅值虽然是高了，但驱动电流会降低。因为内阻极大，导致没有了输出能力。这样的话基本是用不了的。为了增加驱动能力我们应该怎么处理下呢?我们能想到了什么器件？没错，三极管。它是一个电流器件，可以放大电流。问题是又想放大电流，又不能降低幅值，所以三极管应该选择电压跟随器的接法。

电流放大了也会带来新的问题，输出不能被短路，电流增大就意味这电阻变小，短路的会很大可能会烧毁器件。相对于需要上拉输出的比较器，内阻就很大，即使是上拉电阻的阻值也很大，所以比较器是不害怕短路的，即使短路电流也不会很大。运放就不一样了，很怕输出短路，所以我们还要设计一个输出短路保护。这样即使使用时不注意短接了，也不至于烧毁器件，可以减少必要的麻烦。

那短路了我们应该怎么做呢？我们怎么知道是短路呢？有什么判断条件呢？既然短路，那肯定电流不会小吧，我们可以采样输出电流。可以串联一个固定小阻值的电阻，根据电阻上的压降判断电流。只要电流大于某个值时关断输出，是不是就可以实现输出保护了。接下来我们一步步的实现这些想法。

我们来看下运放的第一级：

![运放第一级](https://imgs.boringhex.top/blog/202305051000555.png)

上面这图就实现了，差分小信号——差分小电流-—放大的差分电流信号。由于阻抗无穷大，所以等效的差分电流极小。为了更好的控制，所以需要放大差分电流。

![电流放大电路](https://imgs.boringhex.top/blog/202305051001310.png)

我们看Q5的E极，放大后的电流相减，再到Q7的BE极回路，电流就已经放大了。这个小电流乘以阻抗就会得到一个可控的电压。这个电压就是OUT点单端对地的电压了，这个很大的电阻就是Q7的CE的阻抗。现在是不是又实现了单端对地电压信号的输出。接下来再对OUT点进行幅值放大，我们可以用三极管放大。想要放大电压是不是就是小电流乘以大电阻。继续重新整理的下图。

![运放内部前二级电路](https://imgs.boringhex.top/blog/202305241710169.png)

大家看这个图有没有对C点的电流流向产生疑问呢？如果U+ > U-，那么Ic2 < Ic1，这个时候Q6的BE会有一部分电流流入，我们说这个电流就是他们放大后的差。相反，如果U+ < U-，Ic2 > Ic1,那么电流是不能反过来流的。看上图，B点电位的上升和下降可以看作Q6的内阻增大或减小。是不是可以看作B点对地的电位变化。C点的电流变化，引起电位变化，从而影响B点的电位变化。这时我们就可以看作由电流差，转为了单端的对地电压 了。现在电压的幅值是变大了，但是没有带载能力，接下来我们还要继续往后看。

A点要想有带载能力根据上面理论想到射级跟随器，来增大带载能力，按上面提到的还应该要防止输出短路电路。我们需要检测电流，我们可以在回路上串联一个小电阻，接下来就让这电阻两端的电压驱动某个开关让电路停止输出。

![加第三级的运放内部电路](https://imgs.boringhex.top/blog/202305241713899.png)

我们来看上图，想一下过流保护的过程。只要短路,A点就会拉低，Q10，Q11的管子就关断了，是不是就起到了保护的作用。其实到这里运放内部基本已经差不多了。我们来总结下我们一路走过的过程：

> 差分放大信号——极小的差分电流信号——电流信号放大——放大电流差——单端对地电压——放大电压幅值——射级跟随器电流放大——短路输出保护

其实这电路里面还有些问题，首先R1 在实际中为电流源。C点在发生改变时A点变化会不及时，因为两点间途径了许多三极管，这样就会有许多结电容，造成响应延迟，要想解决这个问题我们需要在两点之间加一个电压不会突变的器件，电容。

接下来再分析下这个电容：

C点电位发生改变时，A点电位会跟随变化。因为电容的两端不能激变。电路稳定后，我们假设电容的两端压是2V，这时C点电位发生了激变，从1V变为了2V,那么A点电位这个时候就变成了4V。相当于水涨船高。

![运放内部电路](https://imgs.boringhex.top/blog/202305241714624.png)

通过分析，C点和A点是反相位，C点突然变大，对电容进行充电，A点电位也会升高，A点电位升高，C点电位就会下降，这个过程是一个负反馈。运放内部基本结构知识就这些了，接下里我们就将讨论什么时候会用到这样的电路。
