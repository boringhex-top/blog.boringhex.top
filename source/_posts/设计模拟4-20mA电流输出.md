---
title: 设计模拟4-20mA电流输出
date: 2023-07-21 11:42:09
categories:
tags:
    - 硬件
    - 嵌入式
---

## 1. 原理

4-20ma电流输出的目的不用多说，今天就简单聊一下4-20ma电流输出是怎么设计出来的，并介绍一种国产集成芯片解决方案。

一般用分离器件搭建的实现原理都是通过单片机控制一个三极管，使其工作在放大区，因为放大区放大并不是线性的，因此需要在串接一个电阻，通过检测电阻电压，单片机来反馈调节三极管的输入，然后从而实现4-20ma电流输出。

今天我们介绍通过GP8102S芯片来实现4-20ma电流输出设计，还有另外一款芯片GP8212S，两者区别是一个是pwm转4-20ma电流输出，另外一个是I2C转4-20ma电流输出，同时精度略有区别，本文主要讲解GP8102S芯片。

<!-- more -->

![GP8102S](https://imgs.boringhex.top/blog/202307092142918.png)

它的实现原理通过控制PWM的占空比，控制三极管工作在放大区，在三极管上串联一个采样电阻，通过VFB反馈给芯片内部，从而控制输出，调节三极管。这只是一个简单的设计原理，下面我们看一下具体的设计。

## 2. 使用GP8102S或GP8212S进行设计

和平时我们使用GPIO输出有两种模式开漏和推完类似，4-20ma电流输出分为共地型和共源型，其主要表现为通信的电由哪一方提供。

### 2.1 共地型设计

![共地型设计](https://imgs.boringhex.top/blog/202307092142633.png)

LM321的作用是生成反馈电压，输入到IOUT2，来调节IOUT的输出。对于GP8102S中，Rs一般采用250Ω，GP8212S中，Rs一般采用100Ω。

相对采用1M的电阻，下面这种设计方案能够提高更高的精度。

![提高精度](https://imgs.boringhex.top/blog/202307092143827.png)

说明：

1. 是0/4-20mA输出（共地型三线制）， Q1选择TO252/SOT223等封装的NPN，作为功率管承受4-20mA所产生发热。
2. Rs的精度至关重要，建议采用0.1%精度，同时因为其要流过4-20mA电流，因此要根据功率选择合理的封装。

### 2.2 共源型设计

![共源型设计](https://imgs.boringhex.top/blog/202307092143130.png)

说明：

1. 0/4-20mA输出（共源型三线制），MOS管选择TO252/SOT223等封装的NMOS， 作为功率管承受4-20mA所产生发热 。
2. 同样Rs的精度至关重要，建议采用0.1%精度，同时因为其要流过4-20mA电流，因此要根据功率选择合理的封装。
3. 对于这种电是由外部提供的端口处，一定要添加一个TVS来保护芯片。

### 2.3 其它电流需求

有的时候我们可能因为设备特殊0/4-20mA输出满足不了需求，可能需要4-35mA输出，这里提供一种思路。

根据电流输出公式IOUT=5V * DPWM /Rs(DPWM为PWM信号的占空比) 可知，IOUT输出的上线跟电阻Rs有一定的关系，因此通过减小Rs电阻，可以提高IOUT输出范围。但是一定要考虑好三极管的选型，完美配合才能出现最佳效果，当然对于我们平时来讲，不需要把范围设计过大，因为过大的范围会降低输出的精度。

## 3. 隔离光耦电源连接方案

有的时候我们设计需要隔离，可以采用下面方法，在选择光耦的时候，频率的选择要格外注意。

在隔离应用中光耦电源有两种接法： 

1. V5V为光耦电源； 
2. V5V经过NPN管9013后作为电源。 前者电路简单，后者光耦引入误差小 .

![隔离方案](https://imgs.boringhex.top/blog/202307092144916.png)

下面是一个完整的隔离方案：

1. 利用APC芯片GP9303将模拟信号4-20mA转换成PWM。
2. PWM信号通过光耦隔离 。 TLP1488为低速光耦，适合应用在PWM频率低于500Hz的场合， TLP1788为高速光耦，适合应用在PWM频率低于25Khz的场合。
3. 隔离后的PWM信号送给PAC芯片GP8102S后还原成电流输出。  

![完整隔离方案](https://imgs.boringhex.top/blog/202307092144840.png)

## 4. 利用GP8102S实现0-40V 的可编程电压输出  

GP8102S除了能实现模拟电流的输出，其实还可以实现模拟电压的输出，如下就是一个PWM 控制的线性稳压方案：

基于 GP8102S+2SD882  ，利用 GP8102S 与外接扩流三极管实现闭环控制，输出电压为 VOUT。VOUT=5V * DPWM * (R1+R2)/R2， DPWM为 PWM 信号的占空比，通过此电路可以实现 0-40V 的可编程电压输出  。

![可编程电压源](https://imgs.boringhex.top/blog/202307092144046.png)
